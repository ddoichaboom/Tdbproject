# TDB 디스펜서 클라이언트 프로젝트 컨텍스트

## 1. 전체 목표
- 라즈베리파이 GUI 애플리케이션의 기능을 완성하고 사용자 경험(UX)을 개선합니다.
- 백그라운드에서 실행되는 하드웨어 제어 로직과 GUI 간의 상호작용을 안정적으로 구현합니다.

## 2. 현재까지의 핵심 진행 상황
- **GUI 레이아웃 개선**: 기존 그리드에서 중복 정보를 제거하고, 더 유용한 정보를 표시하도록 레이아웃을 전면 개편 완료.
  - **Tile 2**: 약품 재고 현황 (슬롯별 약 이름 + 잔량/총량)
  - **Tile 3**: 오늘의 전체 스케줄 (시간대별 사용자 + 약 이름)
  - **Tile 5**: 최근 배출 기록 (시간, 사용자, 결과)
  - **Tile 6**: 등록된 유저 (기존 기능 위치 이동)
- **통합 API 명세서 작성**: 새로운 GUI 레이아웃에 필요한 모든 API(`slots`, `schedules/today`, `dose-history`)와 기존 API 경로 수정(`users`)에 대한 명세서를 `API_CHANGES_SPEC.md` 파일에 작성 완료.
- **클라이언트-서버 연동 완료**:
  - 클라이언트: 앱 시작 시 명세서에 정의된 4개의 API를 모두 호출하여 GUI 타일을 채우도록 구현 완료.
  - 서버: `API_CHANGES_SPEC.md`에 명시된 모든 API 변경사항을 EC2 서버에 배포 완료.
- **핵심 로직 검증**:
    - **배출 기록 저장**: 약물 배출 시 `POST /dispense/report`를 통해 서버의 `dose_history` 테이블에 기록이 저장되는 기존 로직이 정상적으로 구현되어 있음을 확인.
    - **빈 스케줄 건너뛰기**: `process_queue` 함수가 중간 시간대(예: 점심)의 스케줄이 비어있을 경우, 해당 단계를 건너뛰고 다음 단계로 정상 진행함을 테스트를 통해 확인.
- **안정화 작업**: 복잡했던 과거 기능(QR 크기 조정, 카운트다운 등) 롤백, 카드 태그 시 타일 내용 덮어쓰기 버그 수정, 테스트 중 `journalctl` 및 `tdb.service`로 인한 시리얼 포트 점유 문제 해결 등 코드 안정성 확보.

## 3. 현재 시스템 상태
- **정상 동작**: 클라이언트와 서버 간의 모든 API 연동이 완료되었습니다. 클라이언트 시작 시 새로운 GUI 레이아웃의 모든 타일(**재고 현황, 전체 스케줄, 최근 기록, 사용자 목록**)에 실제 데이터가 정상적으로 표시됩니다.
- **임시 조치 제거**: '최근 배출 기록' 타일의 임시 '완료' 표시 기능은 실제 서버 데이터를 받아오는 로직으로 대체되었습니다.

## 4. 다음 단계
- **[완료] 서버 업데이트 및 최종 검증**:
  - 서버 배포가 완료되었으며, `sudo systemctl restart tdb.service` 명령으로 클라이언트를 재시작하여 모든 타일에 실제 데이터가 정상적으로 표시되는 것을 최종 검증 완료했습니다.
- **[유지보수]**: 추가적인 기능 개선이나 버그 수정이 필요할 경우 대응합니다.
